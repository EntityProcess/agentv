{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "AgentEvo Evaluation Dataset",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "description": {
      "type": "string",
      "description": "Human-readable overview of the dataset or panel excerpt."
    },
    "version": {
      "type": ["string", "number"],
      "description": "Optional schema or dataset version tag."
    },
    "tags": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Optional labels describing the dataset."
    },
    "evalcases": {
      "type": "array",
      "minItems": 1,
      "items": {
        "$ref": "#/definitions/evalcase"
      },
      "description": "Collection of evaluation cases to execute."
    }
  },
  "required": ["evalcases"],
  "definitions": {
    "evalcase": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "description": "Stable identifier for the evaluation case."
        },
        "name": {
          "type": "string",
          "description": "Optional display name for dashboards."
        },
        "summary": {
          "type": "string",
          "description": "Optional short description shown in reports."
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "execution": {
          "type": "object",
          "description": "Overrides for execution target, grader, or other runner hints.",
          "additionalProperties": true,
          "properties": {
            "target": {
              "type": "string"
            },
            "grader": {
              "type": "string"
            }
          }
        },
        "checkpoint": {
          "type": "string",
          "description": "Logical checkpoint identifier when multiple evalcases belong to the same conversation."
        },
        "conversationId": {
          "type": "string",
          "description": "Shared identifier to group evalcases that stem from the same underlying dialogue."
        },
        "input": {
          "$ref": "#/definitions/chatTranscript",
          "description": "Messages and optional context sent to the agent under test."
        },
        "expected": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "outcome": {
              "description": "Gold outcome description and optional rubric used for grading.",
              "oneOf": [
                {
                  "type": "string"
                },
                {
                  "type": "object",
                  "additionalProperties": false,
                  "properties": {
                    "description": {
                      "type": "string",
                      "description": "Summary of the expected assistant behaviour."
                    },
                    "rubric": {
                      "type": "object",
                      "additionalProperties": false,
                      "properties": {
                        "aspects": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "description": "Structured checklist used by deterministic graders."
                        },
                        "notes": {
                          "type": "string",
                          "description": "Optional free-form guidance for human reviewers or LLM judges."
                        }
                      }
                    },
                    "metadata": {
                      "type": "object",
                      "additionalProperties": true,
                      "description": "Evaluator-specific metadata (thresholds, severity, etc.)."
                    }
                  },
                  "required": ["description"]
                }
              ]
            },
            "messages": {
              "$ref": "#/definitions/messageArray",
              "description": "Canonical assistant transcript used for grading."
            },
            "attachments": {
              "type": "array",
              "items": {
                "type": "object",
                "additionalProperties": true
              },
              "description": "Optional resources (files, artifacts) referenced by the expected answer."
            }
          },
          "required": ["messages"],
          "description": "Gold outputs and scoring metadata."
        },
        "notes": {
          "type": "string",
          "description": "Author notes or rationale captured with the case."
        }
      },
      "required": ["id", "input", "expected"]
    },
    "chatTranscript": {
      "type": "object",
      "additionalProperties": true,
      "properties": {
        "messages": {
          "$ref": "#/definitions/messageArray"
        },
        "context": {
          "type": "object",
          "additionalProperties": true,
          "description": "Additional structured context made available to the agent (tool state, datasets, etc.)."
        }
      },
      "required": ["messages"]
    },
    "messageArray": {
      "type": "array",
      "minItems": 1,
      "items": {
        "$ref": "#/definitions/message"
      }
    },
    "message": {
      "type": "object",
      "additionalProperties": true,
      "properties": {
        "role": {
          "type": "string",
          "description": "Sender role (system, user, assistant, tool, etc.)",
          "anyOf": [
            {
              "enum": ["system", "user", "assistant", "tool"]
            },
            {
              "pattern": "^[a-zA-Z0-9_-]+$"
            }
          ],
          "default": "user"
        },
        "name": {
          "type": "string",
          "description": "Optional tool/function name associated with the message."
        },
        "content": {
          "description": "Message payload. Supports plain strings, structured content objects, or arrays of parts.",
          "oneOf": [
            {
              "type": "string"
            },
            {
              "$ref": "#/definitions/contentObject"
            },
            {
              "type": "array",
              "type": {
                "type": "string",
                "description": "Semantic type identifier (text, file, tool_call, etc.)",
                "anyOf": [
                  {
                    "enum": [
                      "text",
                      "file",
                      "tool_call",
                      "tool_result",
                      "json",
                      "markdown"
                    ]
                  },
                  {
                    "pattern": "^[a-zA-Z0-9_-]+$"
                  }
                ]
              },
    },
    "contentObject": {
      "type": "object",
      "additionalProperties": true,
      "properties": {
        "type": {
          "type": "string",
          "description": "Semantic type identifier (text, file, tool_call, etc.).",
          "enum": [
            "text",
            "file",
            "tool_call",
            "tool_result",
            "json",
            "markdown",
            "custom"
          ]
        },
        "value": {
          "type": "string",
          "description": "Content body when applicable."
        },
        "path": {
          "type": "string",
          "description": "Filesystem or URI reference if the content points to an external resource."
        },
        "mimeType": {
          "type": "string",
          "description": "Optional MIME type for binary payloads."
        },
        "metadata": {
          "type": "object",
          "additionalProperties": true
        }
      },
      "required": ["type"]
    }
  }
}
