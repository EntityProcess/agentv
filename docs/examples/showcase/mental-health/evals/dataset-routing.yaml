$schema: agentv-eval-v2
description: |-
  Evaluation suite for 'Psychology Router'.
  Verifies correct selection of therapeutic framework based on client needs.
execution:
  target: default
  evaluators:
    - name: json_schema_validator
      type: code
      script: uv run debug_validator.py
    - name: content_evaluator
      type: llm_judge

evalcases:
  # Case 1: Routing to Listening (Ah Yang)
  # Rationale: Client is venting grievance and describing a complex dynamic. Needs understanding first.
  - id: route-to-listening
    outcome: |-
      Must select 'three_levels_listening'.
      Rationale should mention "complex grievance", "venting", or "need for understanding".
    input_messages:
      - role: user
        content:
          - type: text
            value: |-
              Route the following client statement to the best framework (Listening vs. Encouragement).

              Client Statement:
              "I have to go to work every day, take care of the kids, do the housework, and cook. What about my husband? He only knows how to hold his phone and play games. Sometimes when I ask him to help get something, he moves so slowly. It really makes me angry."
          - type: file
            value: ../skills/routing.md
    expected_messages:
      - role: assistant
        content: |-
          {
            "routing_decision": {
              "selected_framework": "three_levels_listening",
              "confidence": "high",
              "rationale": "The client is expressing deep grievance, anger, and confusion about a relationship dynamic. They need to feel heard and have the dynamic ('Pursuer-Distancer') analyzed before moving to solutions."
            },
            "client_statement_analysis": {
              "primary_indicators": [
                "Expressing complex grievance about household responsibilities",
                "Venting frustration about relationship dynamic",
                "Describing pursuer-distancer pattern"
              ],
              "contraindications": [],
              "therapeutic_urgency": "routine"
            },
            "framework_output": {},
            "metadata": {
              "alternative_frameworks_considered": [
                {
                  "framework": "resource_focused_encouragement",
                  "score": 0.3,
                  "reason_not_selected": "Client needs understanding and validation of the dynamic first, not reframing"
                }
              ]
            }
          }

  # Case 2: Routing to Encouragement (Restrained Father)
  # Rationale: Client is expressing hopelessness ("raised son for nothing") but hides a resource (Restraint). Needs Reframing.
  - id: route-to-encouragement-father
    outcome: |-
      Must select 'resource_focused_encouragement'.
      Rationale should mention "finding the resource", "reframing self-blame", or "validating restraint".
    input_messages:
      - role: user
        content:
          - type: text
            value: |-
              Route the following client statement to the best framework.

              Client Statement:
              "I was going to explode, I really wanted to hit him! But... in the end, I didn't raise my hand. I feel like I raised this son for nothing."
          - type: file
            value: ../skills/routing.md
    expected_messages:
      - role: assistant
        content: |-
          {
            "routing_decision": {
              "selected_framework": "resource_focused_encouragement",
              "confidence": "high",
              "rationale": "The client is expressing hopelessness and self-blame ('raised for nothing'), but the narrative contains a hidden positive resource (self-control). The most effective intervention is to reframe this restraint as a success."
            },
            "client_statement_analysis": {
              "primary_indicators": [
                "Self-blame ('raised this son for nothing')",
                "Hidden resource (restraint from hitting)",
                "Behavior they dislike but has positive protective intent"
              ],
              "contraindications": [],
              "therapeutic_urgency": "elevated"
            },
            "framework_output": {},
            "metadata": {
              "alternative_frameworks_considered": [
                {
                  "framework": "three_levels_listening",
                  "score": 0.4,
                  "reason_not_selected": "Client needs immediate reframing of restraint as strength, not just understanding"
                }
              ]
            }
          }

  # Case 3: Routing to Encouragement (Job Seeker)
  # Rationale: Client expresses "I am useless/broken". Needs Normalization and Empowerment.
  - id: route-to-encouragement-job
    outcome: |-
      Must select 'resource_focused_encouragement'.
      Rationale should mention "low self-efficacy", "empowerment", or "normalization of failure".
    input_messages:
      - role: user
        content:
          - type: text
            value: |-
              Route the following client statement to the best framework.

              Client Statement:
              "I sent many resumes with no response. I doubt myselfâ€”am I unable to do anything? I am in pain, unhappy every day, and don't know what to do."
          - type: file
            value: ../skills/routing.md
    expected_messages:
      - role: assistant
        content: |-
          {
            "routing_decision": {
              "selected_framework": "resource_focused_encouragement",
              "confidence": "high",
              "rationale": "The client is in a state of low self-worth and despair ('unable to do anything'). They require Normalization (job market is tough) and Resource identification (persistence) to rebuild self-efficacy."
            },
            "client_statement_analysis": {
              "primary_indicators": [
                "Self-blame and hopelessness ('unable to do anything')",
                "Expressing stuckness ('don't know what to do')",
                "Hidden resource (persistence in sending resumes)"
              ],
              "contraindications": [],
              "therapeutic_urgency": "elevated"
            },
            "framework_output": {},
            "metadata": {
              "alternative_frameworks_considered": [
                {
                  "framework": "three_levels_listening",
                  "score": 0.35,
                  "reason_not_selected": "Client needs empowerment and normalization more than deep understanding at this stage"
                }
              ]
            }
          }

  # Case 4: Routing to Listening (Gatekeeper)
  # Rationale: Client presents a distorted reality ("I am doing good") that hides dysfunction. Needs Process Analysis, not Encouragement (which would enable the dysfunction).
  - id: route-to-listening-gatekeeper
    outcome: |-
      Must select 'three_levels_listening'.
      Rationale should mention "dysfunctional dynamic", "lack of insight", or "need to analyze the process". Encouragement here would likely reinforce the triangulation.
    input_messages:
      - role: user
        content:
          - type: text
            value: |-
              Route the following client statement to the best framework.

              Client Statement:
              "I translate for my wife and mom so they don't get hurt. I tell my wife Mom is just worried, and I tell Mom my wife is just tired. Why do I feel so exhausted if I'm doing such a good thing?"
          - type: file
            value: ../skills/routing.md
    expected_messages:
      - role: assistant
        content: |-
          {
            "routing_decision": {
              "selected_framework": "three_levels_listening",
              "confidence": "high",
              "rationale": "The client is engaging in 'Triangulation' (blocking direct communication) but frames it as 'doing a good thing'. Encouraging this would reinforce the pathology. Listening/Process analysis is needed to help him see the cost of his gatekeeping role."
            },
            "client_statement_analysis": {
              "primary_indicators": [
                "Dysfunctional dynamic (triangulation)",
                "Lack of insight ('doing a good thing')",
                "Confusion about exhaustion despite 'good intentions'"
              ],
              "contraindications": [
                "Resource-focused encouragement would reinforce the pathological pattern"
              ],
              "therapeutic_urgency": "routine"
            },
            "framework_output": {},
            "metadata": {
              "alternative_frameworks_considered": [
                {
                  "framework": "resource_focused_encouragement",
                  "score": 0.2,
                  "reason_not_selected": "Encouraging the 'translation' behavior would enable and reinforce the triangulation dynamic"
                }
              ]
            }
          }