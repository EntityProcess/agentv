# AgentV Eval Schema Example
# Demonstrates schema features with real file references and minimal redundancy

$schema: agentv-eval-v2
description: Example showing basic features, conversation threading, multiple evaluators, and ACE optimization

# File-level default target (optional)
# Can be overridden per eval case via execution.target
target: default

evalcases:
  # ==========================================
  # Example 1: Basic V2 features with file references
  # Demonstrates: input_messages, expected_messages, file references, array content format
  # ==========================================
  - id: code-review-javascript
    
    outcome: |
      Assistant provides helpful code analysis and mentions SUPERSECRET_INSTRUCTION_MARKER_JAVASCRIPT
    
    input_messages:
      - role: system
        content: You are an expert software developer who provides clear, concise code reviews.
      - role: user
        content:
          # Content can be a string or an array of content blocks
          # Array format supports mixed text and file references
          - type: text
            value: |-
              Please review this JavaScript function:
              
              ```javascript
              function calculateTotal(items) {
                let total = 0;
                for (let i = 0; i < 0; i++) {
                  total += items[i].price * items[i].quantity;
                }
                return total;
              }
              ```
          # File references are resolved relative to the eval file directory
          # Files ending in .instructions.md are treated as guidelines
          - type: file
            value: ../../prompts/javascript.instructions.md
          - type: file
            value: ../local-cli/attachments/example.txt
    
    expected_messages:
      - role: assistant
        content: |-
          The function has a critical bug in the loop condition. Here's my analysis (SUPERSECRET_INSTRUCTION_MARKER_JAVASCRIPT):
          
          **Critical Issue:**
          - Loop condition `i < 0` means the loop never executes (should be `i < items.length`)
          
          **Suggestions:**
          - Fix the loop: `for (let i = 0; i < items.length; i++)`
          - Consider using `reduce()` for a more functional approach
          - Add input validation for edge cases

  # ==========================================
  # Example 2: Advanced features - conversation_id, multiple evaluators
  # Demonstrates: conversation threading, execution config, target override, evaluators
  # Note: Optimization (ACE, etc.) is configured separately in opts/*.yaml files
  # ==========================================
  - id: code-gen-python-comprehensive
    
    # conversation_id represents the full conversation that may be split into multiple eval cases
    # Most commonly, eval cases test the final response, but could also test intermediate turns
    conversation_id: python-code-generation
    
    outcome: AI generates correct Python function with proper error handling, type hints, and mentions SUPERSECRET_INSTRUCTION_MARKER_PYTHON

    execution:
      # Override file-level target for this specific eval case
      target: azure_base
      
      # Multiple evaluators - supports both code-based and LLM judges
      evaluators:
        - name: keyword_check
          type: code  # Code evaluators handle regex, keywords, linting, etc.
          # Note: script paths shown here are examples - implement as needed
          script: ../evaluators/scripts/check_python_keywords.py
        - name: semantic_correctness
          type: llm_judge  # LLM-based semantic evaluation
          prompt: ../evaluators/prompts/code-correctness-judge.md
          model: gpt-5-chat
    
    input_messages:
      - role: system
        content: You are a code generator that follows specifications exactly.
      - role: user
        content:
          - type: text
            value: |-
              Create a Python function that:
              1. Takes a list of integers
              2. Returns the second largest number
              3. Handles edge cases (empty list, single item, duplicates)
              4. Raises appropriate exceptions for invalid input
          # Reference to real instruction file
          - type: file
            value: ../../prompts/python.instructions.md
    
    expected_messages:
      - role: assistant
        content:
          - type: file
            value: ./snippets/python-second-largest.md
