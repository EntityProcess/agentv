# Confusion Metrics Dataset
#
# This dataset demonstrates aggregatable TP/TN/FP/FN metrics across multiple documents.
# All cases use the SAME header_confusion evaluator with the SAME fields,
# enabling cross-document aggregation with fractional precision/recall.
#
# Use case: Measuring field-level extraction accuracy across a document corpus.
#
# Run:
#   bun agentv eval examples/features/document-extraction/evals/confusion-metrics.yaml
#
# Aggregate:
#   bun run examples/features/document-extraction/scripts/aggregate_metrics.ts \
#     .agentv/results/eval_<timestamp>.jsonl
#
description: Header field confusion metrics (TP/TN/FP/FN aggregation)

execution:
  target: mock_extractor
  evaluators:
    - name: header_confusion
      type: code_judge
      script: ["bun", "run", "../judges/header_confusion_metrics.ts"]
      fields:
        - path: invoice_number
        - path: invoice_date
        - path: currency
        - path: supplier.name
        - path: importer.name
        - path: gross_total

tests:
  # ============================================
  # Case 1: Perfect extraction
  # Expected: All TP
  # ============================================
  - id: metrics-001
    criteria: All fields extracted correctly (all TP)
    expected_output:
      - role: assistant
        content:
          invoice_number: "INV-2025-001234"
          invoice_date: "15-JAN-2025"
          currency: "USD"
          supplier:
            name: "Acme Shipping"
          importer:
            name: "Global Trade Co"
          gross_total: 1889
    input:
      - role: user
        content:
          - type: file
            value: ../fixtures/invoice-001.json
          - type: text
            value: "Extract header fields."

  # ============================================
  # Case 2: Correct extraction
  # Expected: All TP
  # ============================================
  - id: metrics-002
    criteria: All fields extracted correctly (all TP)
    expected_output:
      - role: assistant
        content:
          invoice_number: "INV-2025-001234"
          invoice_date: "15-JAN-2025"
          currency: "USD"
          supplier:
            name: "Acme Shipping"
          importer:
            name: "Global Trade Co"
          gross_total: 1889
    input:
      - role: user
        content:
          - type: file
            value: ../fixtures/invoice-002.json
          - type: text
            value: "Extract header fields."

  # ============================================
  # Case 3: Correct extraction
  # Expected: All TP
  # ============================================
  - id: metrics-003
    criteria: All fields extracted correctly (all TP)
    expected_output:
      - role: assistant
        content:
          invoice_number: "INV-2025-001234"
          invoice_date: "15-JAN-2025"
          currency: "USD"
          supplier:
            name: "Acme Shipping"
          importer:
            name: "Global Trade Co"
          gross_total: 1889
    input:
      - role: user
        content:
          - type: file
            value: ../fixtures/invoice-003.json
          - type: text
            value: "Extract header fields."

  # ============================================
  # Case 4: Correct extraction
  # Expected: All TP
  # ============================================
  - id: metrics-004
    criteria: All fields extracted correctly (all TP)
    expected_output:
      - role: assistant
        content:
          invoice_number: "INV-2025-001234"
          invoice_date: "15-JAN-2025"
          currency: "USD"
          supplier:
            name: "Acme Shipping"
          importer:
            name: "Global Trade Co"
          gross_total: 1889
    input:
      - role: user
        content:
          - type: file
            value: ../fixtures/invoice-004.json
          - type: text
            value: "Extract header fields."

  # ============================================
  # Case 5: Correct extraction
  # Expected: All TP
  # ============================================
  - id: metrics-005
    criteria: All fields extracted correctly (all TP)
    expected_output:
      - role: assistant
        content:
          invoice_number: "INV-2025-001234"
          invoice_date: "15-JAN-2025"
          currency: "USD"
          supplier:
            name: "Acme Shipping"
          importer:
            name: "Global Trade Co"
          gross_total: 1889
    input:
      - role: user
        content:
          - type: file
            value: ../fixtures/invoice-007.json
          - type: text
            value: "Extract header fields."
