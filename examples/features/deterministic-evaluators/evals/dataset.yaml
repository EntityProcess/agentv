# Deterministic Evaluator Examples
# Shows built-in assertion types for common deterministic checks.
# These replace the need for external code_judge scripts for simple assertions.

name: deterministic-evaluators
description: Built-in deterministic assertions â€” contains, regex, JSON validation, equals

execution:
  target: default

tests:
  # --- contains ---
  - id: contains-basic
    criteria: Response mentions the word "Hello"
    input: "Say hello to the user."
    expected_output: "Hello there! How can I help you today?"
    assert:
      - type: contains
        value: "Hello"

  # --- regex ---
  - id: regex-email
    criteria: Response contains a valid email address
    input:
      - role: system
        content: "You must include the email support@example.com in your response."
      - role: user
        content: "Provide your contact email."
    expected_output: "You can reach me at support@example.com."
    assert:
      - type: regex
        value: "[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}"

  # --- equals ---
  - id: equals-exact
    criteria: Response is exactly the expected string
    input:
      - role: system
        content: "You are a calculator. Respond with only the numeric result, nothing else."
      - role: user
        content: "What is 2+2?"
    expected_output: "4"
    assert:
      - type: equals
        value: "4"

  # --- regex with starts-with pattern ---
  - id: starts-with-prefix
    criteria: Response begins with a greeting
    input: "Start your reply with 'Dear User'."
    expected_output: "Dear User, thank you for contacting us."
    assert:
      - type: regex
        value: "^Dear User"

  # --- is_json ---
  - id: is-json-valid
    criteria: Response is valid JSON
    input:
      - role: system
        content: "You are an API. Respond only with valid JSON, no markdown or explanations."
      - role: user
        content: "Return a JSON object with a status field set to ok and code 200."
    expected_output: '{"status": "ok", "code": 200}'
    assert:
      - type: is_json

  # --- combining multiple assertions on one test ---
  - id: multi-assertion
    criteria: Response is valid JSON that contains a "result" key
    input:
      - role: system
        content: "You are an API. Respond only with valid JSON, no markdown or explanations."
      - role: user
        content: 'Return a JSON object with a "result" key set to the number 42.'
    expected_output: '{"result": 42}'
    assert:
      - type: is_json
        required: true
      - type: contains
        value: '"result"'

  # --- required gate example ---
  - id: required-gate
    criteria: Response must be valid JSON (required) and ideally contain a message field
    input:
      - role: system
        content: "You are an API. Respond only with valid JSON, no markdown or explanations."
      - role: user
        content: 'Return a JSON object with a "message" field set to "success".'
    expected_output: '{"message": "success"}'
    assert:
      - type: is_json
        required: true
      - type: contains
        value: '"message"'
      - type: contains
        value: success
