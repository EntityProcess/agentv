# AgentV Rubric Evaluator Example
# Demonstrates the rubric-based evaluation feature

description: Example showing rubric evaluator with inline rubrics and criteria

execution:
  target: default

tests:
  # ==========================================
  # Example 1: Simple inline rubrics
  # Demonstrates: inline rubrics as strings, criteria field
  # ==========================================
  - id: code-explanation-simple

    criteria: |-
      Provide a clear explanation of how quicksort works, including time complexity

    input:
      - role: user
        content: Explain how the quicksort algorithm works

    expected_output:
      - role: assistant
        content: |-
          Quicksort is a divide-and-conquer sorting algorithm:

          1. Choose a pivot element from the array
          2. Partition: rearrange elements so smaller values are on the left, larger on the right
          3. Recursively apply quicksort to the left and right partitions

          Time Complexity:
          - Best/Average: O(n log n)
          - Worst case: O(n²) when poorly chosen pivots

    # Inline rubrics - simple string format
    rubrics:
      - Mentions divide-and-conquer approach
      - Explains the partition step
      - States time complexity correctly

  # ==========================================
  # Example 2: Detailed rubric objects
  # Demonstrates: rubric objects with weights and required flags
  # ==========================================
  - id: technical-writing-detailed

    criteria: |-
      Write a comprehensive guide on HTTP status codes with examples

    input:
      - role: user
        content: Write a guide explaining HTTP status codes

    expected_output:
      - role: assistant
        content: |-
          # HTTP Status Codes Guide

          ## 2xx Success
          - 200 OK: Request succeeded
          - 201 Created: Resource created successfully

          ## 4xx Client Errors
          - 400 Bad Request: Invalid syntax
          - 404 Not Found: Resource doesn't exist

          ## 5xx Server Errors
          - 500 Internal Server Error: Server-side error

    # Detailed rubric objects with weights and required flags
    rubrics:
      - id: structure
        outcome: Has clear headings and organization
        weight: 1.0
        required: true

      - id: success-codes
        outcome: Covers 2xx success codes with examples
        weight: 2.0
        required: true

      - id: client-errors
        outcome: Explains 4xx client error codes
        weight: 2.0
        required: true

      - id: server-errors
        outcome: Explains 5xx server error codes
        weight: 1.5
        required: false

      - id: practical-examples
        outcome: Includes practical use case examples
        weight: 1.0
        required: false

  # ==========================================
  # Example 3: Multiple evaluators with rubric
  # Demonstrates: combining rubric evaluator with other evaluators
  # ==========================================
  - id: code-quality-multi-eval
    # Baseline note: candidates without type hints/edge handling often score lower (~0.75).

    criteria: |-
      Python function that validates email addresses with proper error handling

    input:
      - role: user
        content: Write a Python function to validate email addresses

    expected_output:
      - role: assistant
        content: |-
          import re
          from typing import Optional

          def validate_email(email: str) -> bool:
              """
              Validates if a string is a properly formatted email address.
              
              Args:
                  email: The email string to validate
                  
              Returns:
                  True if valid email format, False otherwise
              """
              if not email or not isinstance(email, str):
                  return False
              
              pattern = r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'
              return bool(re.match(pattern, email))

    # Inline rubrics for semantic checks
    rubrics:
      - Uses regular expressions for email validation
      - Includes type hints
      - Has docstring documentation
      - Handles edge cases (None, empty string)

    execution:
      evaluators:
        # Rubric evaluator is auto-added from inline rubrics field

        # Additional code evaluator for syntax checking
        - name: python_syntax
          type: code_judge
          script: ["uv", "run", "python", "check_syntax.py"]

  # ==========================================
  # Example 4: Using criteria without rubrics
  # Demonstrates: criteria as the evaluation criteria field
  # Note: Use 'agentv generate rubrics' to create rubrics from criteria
  # ==========================================
  - id: summary-task

    # criteria defines evaluation criteria for this case
    criteria: |-
      Provide a concise summary of the key points in under 50 words

    input:
      - role: user
        content: |-
          Summarize this article:

          Climate change is accelerating faster than predicted. Recent studies show
          Arctic ice melting at unprecedented rates, sea levels rising, and extreme
          weather events becoming more frequent. Scientists urge immediate action to
          reduce carbon emissions and transition to renewable energy sources.

    expected_output:
      - role: assistant
        content: |-
          Climate change accelerates with rapid Arctic ice loss and rising seas.
          Extreme weather increases. Scientists call for urgent carbon emission
          cuts and renewable energy adoption.

    # No rubrics defined - will use default llm_judge evaluator
    # To generate rubrics: agentv generate rubrics evals/dataset.yaml

  # ==========================================
  # Example 5: Multi-criteria score_ranges
  # Demonstrates: multiple rubric ids, each with 0–10 score_ranges using shorthand map format,
  # then weighted aggregation. Real-world intent: grading a summary on both factual accuracy and brevity.
  # ==========================================
  - id: summary-multi-criteria-score-ranges-proposed

    criteria: |-
      Provide an accurate summary in under 50 words.

    input:
      - role: user
        content: |-
          Summarize this article in under 50 words:

          Climate change is accelerating faster than predicted. Recent studies show
          Arctic ice melting at unprecedented rates, sea levels rising, and extreme
          weather events becoming more frequent. Scientists urge immediate action to
          reduce carbon emissions and transition to renewable energy sources.

    expected_output:
      - role: assistant
        content: |-
          Climate change is accelerating with rapid Arctic ice loss, rising seas, and
          more extreme weather. Scientists urge urgent emissions cuts and a transition
          to renewable energy.

    rubrics:
      - id: factual_accuracy
        weight: 2.0
        required_min_score: 8
        score_ranges:
          0: Contains major factual errors or contradicts the article.
          3: Mostly on-topic but includes at least one clear factual error or misstates a key claim.
          6: Generally accurate but misses an important point or slightly distorts emphasis.
          8: Accurate and covers the key points with only minor omissions.
          10: Fully accurate, captures all key points with no distortions.

      - id: brevity_and_clarity
        weight: 1.0
        score_ranges:
          0: Exceeds 50 words or is hard to understand.
          3: Under 50 words but unclear, repetitive, or poorly structured.
          6: Under 50 words and mostly clear, but could be more concise or better phrased.
          8: Under 50 words, clear and concise.
          10: Under 50 words, exceptionally clear, concise, and well phrased.
