{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "AgentV Eval Schema",
  "description": "Schema for YAML evaluation files with conversation flows, multiple evaluators, and execution configuration",
  "type": "object",
  "properties": {
    "$schema": {
      "type": "string",
      "description": "Schema identifier",
      "enum": ["agentv-eval-v2"]
    },
    "description": {
      "type": "string",
      "description": "Description of what this eval suite covers"
    },
    "target": {
      "type": "string",
      "description": "Default target configuration name (e.g., default, azure_base, vscode_projectx). Can be overridden per eval case."
    },
    "evalcases": {
      "type": "array",
      "description": "Array of evaluation cases",
      "minItems": 1,
      "items": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "Unique identifier for the eval case"
          },
          "conversation_id": {
            "type": "string",
            "description": "Optional conversation identifier for threading multiple eval cases together"
          },
          "outcome": {
            "type": "string",
            "description": "Description of what the AI should accomplish in this eval"
          },
          "note": {
            "type": "string",
            "description": "Optional note or additional context for the eval case"
          },
          "input_messages": {
            "type": "array",
            "description": "Input messages for the conversation",
            "minItems": 1,
            "items": {
              "type": "object",
              "properties": {
                "role": {
                  "type": "string",
                  "enum": ["system", "user", "assistant", "tool"]
                },
                "content": {
                  "oneOf": [
                    {"type": "string"},
                    {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "type": {"type": "string", "enum": ["text", "file"]},
                          "value": {"type": "string"}
                        },
                        "required": ["type", "value"]
                      }
                    }
                  ]
                }
              },
              "required": ["role", "content"]
            }
          },
          "expected_messages": {
            "type": "array",
            "description": "Expected response messages",
            "minItems": 1,
            "items": {
              "type": "object",
              "properties": {
                "role": {"type": "string", "enum": ["system", "user", "assistant", "tool"]},
                "content": {
                  "oneOf": [
                    {"type": "string"},
                    {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "type": {"type": "string", "enum": ["text", "file"]},
                          "value": {"type": "string"}
                        },
                        "required": ["type", "value"]
                      }
                    }
                  ]
                }
              },
              "required": ["role", "content"]
            }
          },
          "execution": {
            "type": "object",
            "properties": {
              "target": {"type": "string"},
              "evaluators": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "name": {"type": "string"},
                    "type": {"type": "string", "enum": ["code", "llm_judge"]},
                    "script": {"type": "string"},
                    "cwd": {"type": "string"},
                    "prompt": {"type": "string"},
                    "model": {"type": "string"}
                  },
                  "required": ["name", "type"]
                }
              }
            }
          }
        },
        "required": ["id", "outcome", "input_messages", "expected_messages"]
      }
    }
  },
  "required": ["evalcases"]
}
